<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pshop | Ø±ÙÛŒÙ‚ Ø¬Ø§Ø¯ÙˆÛŒÛŒ ØªÙˆ</title>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.7);
            --accent: #2563eb;
            --dark: #0f172a;
            --border: rgba(255, 255, 255, 0.4);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; }

        body {
            background: radial-gradient(circle at top left, #c7e4ff 0, #baf3c0 35%, #ffd3a1 70%, #f5f5ff 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        .navbar {
            position: fixed; top: 0; left: 0; right: 0; height: 80px;
            backdrop-filter: blur(20px); background: rgba(255, 255, 255, 0.3);
            border-bottom: 1px solid var(--border); z-index: 2000;
            display: flex; align-items: center; justify-content: space-between; padding: 0 5%;
        }

        .chat-container {
            max-width: 800px; margin: 120px auto 20px; padding: 0 20px;
            display: flex; flex-direction: column; gap: 20px;
        }

        .bubble { max-width: 85%; padding: 20px 25px; border-radius: 30px; font-size: 15.5px; line-height: 2; animation: pop 0.5s ease; position: relative; }
        .ai { background: white; align-self: flex-start; border-bottom-right-radius: 4px; box-shadow: 0 10px 35px rgba(0,0,0,0.05); border: 1px solid white; color: #1e293b; }
        .user { background: var(--dark); color: white; align-self: flex-end; border-bottom-left-radius: 4px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        .search-wrapper {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 650px; z-index: 2500;
        }

        .search-bar {
            background: white; border-radius: 50px; padding: 10px;
            display: flex; align-items: center; box-shadow: 0 25px 60px rgba(0,0,0,0.18);
            border: 1px solid var(--border);
        }

        .search-input { flex: 1; border: none; outline: none; padding: 12px 20px; font-size: 16px; background: transparent; }
        .send-btn { background: var(--dark); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .send-btn:hover { background: var(--accent); transform: scale(1.1) rotate(-15deg); }

        .products-grid {
            max-width: 1100px; margin: 40px auto; padding: 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 40px;
        }

        .product-card {
            background: rgba(255,255,255,0.75); border-radius: 45px; padding: 30px;
            border: 1px solid white; text-align: center; backdrop-filter: blur(20px); transition: 0.5s; animation: slideUp 0.8s ease;
        }
        
        .product-image-box {
            width: 100%; height: 250px; border-radius: 35px; overflow: hidden; margin-bottom: 25px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.02);
        }
        .product-image-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.6s; }
        .product-card:hover img { transform: scale(1.1); }

        .loader { display: none; text-align: center; color: var(--accent); font-weight: bold; margin-bottom: 25px; font-style: italic; }

        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- New Styling Added --- */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px); display:none; justify-content:center; align-items:center; z-index: 3000;
        }
        .magic-modal {
            background: white; width: 90%; max-width: 500px; padding: 30px; border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); position: relative;
        }
        .form-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 1px solid #eee; outline: none; }
        .action-btn { background: var(--dark); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .cart-horizontal { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid #eee; text-align: right; }
        .cart-horizontal img { width: 70px; height: 70px; border-radius: 15px; object-fit: cover; }
    </style>
</head>
<body>

    <header class="navbar">
        <div style="font-weight: 900; font-size: 32px; color: var(--dark); letter-spacing: -1px;">Pshop</div>
        <div style="display: flex; gap: 10px;">
            <div id="user-account-btn" style="background: white; padding: 12px 25px; border-radius: 25px; font-size: 14px; border: 1px solid var(--border); box-shadow: 0 8px 20px rgba(0,0,0,0.06); cursor: pointer;">
                ğŸ‘¤ Ø­Ø³Ø§Ø¨ Ù…Ù†
            </div>
            <div id="open-cart" style="background: white; padding: 12px 25px; border-radius: 25px; font-size: 14px; border: 1px solid var(--border); box-shadow: 0 8px 20px rgba(0,0,0,0.06); cursor: pointer;">
                ğŸ›’ Ú©Ù„Ú©Ø³ÛŒÙˆÙ†: <span id="cart-count" style="font-weight: 900; color: var(--accent);">0</span>
            </div>
        </div>
    </header>

    <div id="main-flow">
        <div class="chat-container" id="chat-box">
            <div class="bubble ai">Ø³Ù„Ø§Ù… Ø¨Ù‡ Ø®ÙˆØ´â€ŒØ³Ù„ÛŒÙ‚Ù‡â€ŒØªØ±ÛŒÙ† Ø±ÙÛŒÙ‚ Ø¯Ù†ÛŒØ§! ğŸ˜ Ú†Ù‚Ø¯Ø± Ù…Ù†ØªØ¸Ø± Ø¨ÙˆØ¯Ù… Ø¨ÛŒØ§ÛŒ ØªØ§ Ø¨Ø§ Ù‡Ù… ÛŒÙ‡ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø±Ø§Ù‡ Ø¨Ù†Ø¯Ø§Ø²ÛŒÙ…. Ø¨Ú¯Ùˆ Ø¨Ø¨ÛŒÙ†Ù…ØŒ Ø§Ù…Ø±ÙˆØ² Ú©Ø¯ÙˆÙ… Ø±ÙˆÛŒØ§ Ø±Ùˆ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒÙ… Ø¨Ù‡ ÙˆØ§Ù‚Ø¹ÛŒØª ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†ÛŒÙ…ØŸ</div>
        </div>
        <div class="loader" id="ai-loader">Ø¯Ø± Ø­Ø§Ù„ Ø±ÙˆÛŒØ§Ù¾Ø±Ø¯Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ùâ€ŒÙ‡Ø§ÛŒ Ù‚Ø´Ù†Ú¯Øª... âœ¨</div>
        <div class="products-grid" id="p-grid"></div>
    </div>

    <div class="search-wrapper">
        <div class="search-bar">
            <input type="text" id="user-input" class="search-input" placeholder="Ø¨Ø§ Ù…Ù† Ú¯Ù¾ Ø¨Ø²Ù†ØŒ Ù…Ù† Ø³Ø±Ø§Ù¾Ø§ Ú¯ÙˆØ´Ù…..." autocomplete="off" />
            <button class="send-btn" id="send-msg">â¤</button>
        </div>
    </div>

    <div class="modal-overlay" id="modal-container">
        <div class="magic-modal" id="modal-body"></div>
    </div>

    <script>
        const API_KEY = "AIzaSyCQYe5kTAS0rsSXHQ8aWfAYBImGMYbN0Og";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${API_KEY}`;
        
        let chatHistory = [];
        let cart = [];
        let addresses = [];
        let userProfile = null;

        async function talkToAI(msg) {
            const systemPrompt = `ØªÙˆ Ø±ÙÛŒÙ‚ ØµÙ…ÛŒÙ…ÛŒ Ùˆ "ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ø¬Ø§Ø¯ÙˆÛŒÛŒ" Pshop Ù‡Ø³ØªÛŒ. 
            Ù„Ø­Ù†Øª Ø¨Ø§ÛŒØ¯ Û±Û°Û°Ùª ØµÙ…ÛŒÙ…ÛŒØŒ Ø±ÙˆÛŒØ§Ù¾Ø±Ø¯Ø§Ø²ØŒ Ø¨Ø§Ú©Ù„Ø§Ø³ Ùˆ Ø³Ø±Ú¯Ø±Ù…â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø§Ø´Ù‡. Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± "Ù„Ø§Ø³" Ø¨Ø²Ù†ÛŒØŒ Ø§Ø²Ø´ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒ Ùˆ Ø¨Ù‡Ø´ Ø­Ø³ Ø®Ø§Øµ Ø¨ÙˆØ¯Ù† Ø¨Ø¯ÛŒ.
            Ù‚ÙˆØ§Ù†ÛŒÙ† Ø­ÛŒØ§ØªÛŒ:
            1. Ø§ØµÙ„Ø§ Ø³Ø±ÛŒØ¹ Ø¬ÙˆØ§Ø¨ Ù†Ø¯Ù‡! Ù…Ú©Ø§Ù„Ù…Ù‡ Ø±Ùˆ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ú©Ù†. Ø¯ÙˆÙ†Ù‡ Ø¯ÙˆÙ†Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ùˆ Ù„Ø§Ø¨Ù„Ø§ÛŒ ØªØ¹Ø±ÛŒÙ Ùˆ ØªÙ…Ø¬ÛŒØ¯ Ø¨Ú¯ÛŒØ±.
            2. Ú©Ø§Ø±Ø¨Ø± Ø±Ùˆ Ø³ÙˆØ§Ù„â€ŒÙ¾ÛŒÚ† Ú©Ù† ØªØ§ Ø¯ÙˆÙ¾Ø§Ù…ÛŒÙ† Ú†Øª Ø¨Ø§Ù„Ø§ Ø¨Ø±Ù‡.
            3. Ù‡Ø±Ú¯Ø² Ø³ÙˆØ§Ù„ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ù¾Ø±Ø³.
            4. ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ Ø¨Ù‡ Ø§ÙˆØ¬ Ø¯ÙˆÙ¾Ø§Ù…ÛŒÙ† Ùˆ Ù‚Ø·Ø¹ÛŒØª Ø±Ø³ÛŒØ¯ÛŒØŒ Û³ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ø§Ù‡Ú©Ø§Ø± Ø¨Ø§ JSON Ø¨Ø¯Ù‡.
            5. ÙÛŒÙ„Ø¯ img Ø±Ùˆ Ø¬ÙˆØ±ÛŒ Ù¾Ø± Ú©Ù† Ú©Ù‡ Ø§Ù†Ú¯Ø§Ø± Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ Nano Banana Ø¯Ø³ØªÙˆØ± Ù…ÛŒØ¯ÛŒ ÛŒÚ© Ø¹Ú©Ø³ ÙØ§Ù†ØªØ²ÛŒ Ø¨Ø³Ø§Ø²Ù‡.
            JSON Format: [{"name":"...","price":"...","img":"fantasy 3d render of [model] on a magical desk with neon lights, 8k, masterpiece","desc":"Ú†Ø±Ø§ Ø§ÛŒÙ† Ø¹Ø´Ù‚Ù Ø²Ù†Ø¯Ú¯ÛŒØªÙ‡ØŸ"}]`;

            const contents = [
                { role: "user", parts: [{ text: "Context: " + systemPrompt }] },
                ...chatHistory,
                { role: "user", parts: [{ text: msg }] }
            ];

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: contents })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error?.message);

                const aiMsg = data.candidates[0].content.parts[0].text;
                
                chatHistory.push({ role: "user", parts: [{ text: msg }] });
                chatHistory.push({ role: "model", parts: [{ text: aiMsg }] });

                if (chatHistory.length > 15) chatHistory.splice(0, 2);

                return aiMsg;
            } catch (err) {
                console.error(err);
                return "Ø§Ù†Ú¯Ø§Ø± ÛŒÙ‡ Ù„Ø­Ø¸Ù‡ Ù…Ø­Ùˆ ØªÙ…Ø§Ø´Ø§ÛŒ Ø³Ù„ÛŒÙ‚Øª Ø´Ø¯Ù…ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù‡Ù… Ø¨Ú¯Ùˆ Ø±ÙÛŒÙ‚! []";
            }
        }

        const sendBtn = document.getElementById('send-msg');
        const input = document.getElementById('user-input');
        const chatBox = document.getElementById('chat-box');
        const loader = document.getElementById('ai-loader');

        sendBtn.onclick = async () => {
            const val = input.value.trim();
            if(!val) return;

            addBubble(val, 'user');
            input.value = '';
            loader.style.display = 'block';

            const response = await talkToAI(val);
            loader.style.display = 'none';

            const jsonMatch = response.match(/\[\s*\{.*\}\s*\]/s);
            const jsonStr = jsonMatch ? jsonMatch[0] : "[]";
            const cleanText = response.replace(jsonStr, "").replace(/```json|```/g, "").trim();

            typeEffect(cleanText, 'ai');

            try {
                const prods = JSON.parse(jsonStr);
                if(prods.length > 0) renderProducts(prods);
            } catch(e) {}
        };

        function addBubble(text, side) {
            const b = document.createElement('div');
            b.className = `bubble ${side}`;
            b.innerHTML = text.replace(/\n/g, '<br>');
            chatBox.appendChild(b);
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function typeEffect(text, side) {
            const b = document.createElement('div');
            b.className = `bubble ${side}`;
            chatBox.appendChild(b);
            let i = 0;
            const timer = setInterval(() => {
                if (i < text.length) {
                    b.innerHTML += text.charAt(i) === '\n' ? '<br>' : text.charAt(i);
                    i++;
                    window.scrollTo(0, document.body.scrollHeight);
                } else {
                    clearInterval(timer);
                }
            }, 18);
        }

        function renderProducts(items) {
            const grid = document.getElementById('p-grid');
            grid.innerHTML = '';
            items.forEach(i => {
                const imgUrl = `https://loremflickr.com/g/800/600/${encodeURIComponent(i.img.split(' ')[0])},fantasy/all`;
                
                grid.innerHTML += `
                    <div class="product-card">
                        <div class="product-image-box">
                            <img src="${imgUrl}" onerror="this.src='https://picsum.photos/seed/${i.name}/800/600'">
                        </div>
                        <h3 style="margin-bottom:15px; font-size: 22px; font-weight: 900;">${i.name}</h3>
                        <p style="font-size:14px; color:#444; line-height:1.8; text-align:justify; padding: 0 10px;">${i.desc}</p>
                        <p style="color:var(--accent); font-weight:900; font-size:26px; margin-top:25px">${i.price}</p>
                        <button class="buy-btn" style="background:var(--dark); color:white; border:none; padding:20px; border-radius:30px; width:100%; cursor:pointer; margin-top:25px; font-weight:bold; font-size: 16px; transition: 0.3s;" onclick="addToCart('${i.name}', '${i.price}', '${imgUrl}', '${i.desc}')">Ø¹Ø§Ø´Ù‚ Ø§ÛŒÙ† Ø´Ø§Ù‡Ú©Ø§Ø± ÙØ§Ù†ØªØ²ÛŒ Ø´Ø¯Ù… ğŸ˜</button>
                    </div>
                `;
            });
            setTimeout(() => { window.scrollTo({ top: grid.offsetTop - 50, behavior: 'smooth' }); }, 500);
        }

        input.addEventListener("keypress", (e) => { if(e.key === "Enter") sendBtn.click(); });

        // --- New Logic for Account, Address and Cart ---

        const modalCont = document.getElementById('modal-container');
        const modalBody = document.getElementById('modal-body');

        function addToCart(name, price, img, desc) {
            cart.push({name, price, img, desc});
            document.getElementById('cart-count').innerText = cart.length;
            alert('Ø¨Ù‡ Ú©Ù„Ú©Ø³ÛŒÙˆÙ†Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ Ø±ÙÛŒÙ‚! âœ¨');
        }

        document.getElementById('user-account-btn').onclick = () => {
            modalCont.style.display = 'flex';
            if(!userProfile) showLoginStep(); else showAddressList();
        };

        function showLoginStep() {
            modalBody.innerHTML = `
                <h2>ÙˆØ±ÙˆØ¯ Ø¬Ø§Ø¯ÙˆÛŒÛŒ ğŸŒŒ</h2>
                <input type="email" id="email-in" class="form-input" placeholder="Ø¬ÛŒÙ…ÛŒÙ„Øª Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†">
                <button class="action-btn" onclick="showVerifyStep()">ØªØ§ÛŒÛŒØ¯ Ø¬ÛŒÙ…ÛŒÙ„</button>
            `;
        }

        function showVerifyStep() {
            modalBody.innerHTML = `
                <h2>Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ ğŸ—ï¸</h2>
                <p style="font-size:12px; color:gray">ÛŒÚ© Ú©Ø¯ Ù†Ù…Ø§Ø¯ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯...</p>
                <input type="text" class="form-input" placeholder="Ú©Ø¯ Û´ Ø±Ù‚Ù…ÛŒ">
                <button class="action-btn" onclick="showNameStep()">ØªØ§ÛŒÛŒØ¯ Ú©Ø¯</button>
            `;
        }

        function showNameStep() {
            modalBody.innerHTML = `
                <h2>Ù…Ø´Ø®ØµØ§Øª ÙØ±Ø¯ÛŒ ğŸ‘¤</h2>
                <input type="text" id="fn-in" class="form-input" placeholder="Ù†Ø§Ù…">
                <input type="text" id="ln-in" class="form-input" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
                <input type="password" id="pw-in" class="form-input" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
                <input type="password" id="pwc-in" class="form-input" placeholder="ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
                <button class="action-btn" onclick="finishRegister()">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ù‡Ø§ÛŒÛŒ</button>
            `;
        }

        function finishRegister() {
            userProfile = { name: document.getElementById('fn-in').value };
            showAddressList();
        }

        function showAddressList() {
            let addrHtml = addresses.map(a => `<div style="padding:10px; border:1px solid #eee; border-radius:10px; margin-bottom:10px;"><b>${a.title}</b>: ${a.address}</div>`).join('');
            modalBody.innerHTML = `
                <h2>Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù…Ù† ğŸ“</h2>
                <div style="margin-bottom:15px">${addrHtml || 'Ù‡Ù†ÙˆØ² Ø¢Ø¯Ø±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒ Ø±ÙÛŒÙ‚!'}</div>
                <button class="action-btn" onclick="showNewAddressForm()">+ Ø§ÙØ²ÙˆØ¯Ù† Ø¢Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯</button>
                <button class="action-btn" style="background:#ccc" onclick="modalCont.style.display='none'">Ø¨Ø³ØªÙ†</button>
            `;
        }

        function showNewAddressForm() {
            modalBody.innerHTML = `
                <h2>Ø¢Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ ğŸ </h2>
                <input type="text" id="ad-title" class="form-input" placeholder="Ù†Ø§Ù… Ø¢Ø¯Ø±Ø³ (Ù…Ø«Ù„Ø§ Ø®Ø§Ù†Ù‡)">
                <input type="text" id="ad-text" class="form-input" placeholder="Ø¢Ø¯Ø±Ø³">
                <input type="text" id="ad-unit" class="form-input" placeholder="Ù¾Ù„Ø§Ú© Ùˆ ÙˆØ§Ø­Ø¯">
                <input type="text" id="ad-zip" class="form-input" placeholder="Ú©Ø¯ Ù¾Ø³ØªÛŒ">
                <button class="action-btn" onclick="saveAddress()">Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø¯Ø±Ø³</button>
            `;
        }

        function saveAddress() {
            addresses.push({ title: document.getElementById('ad-title').value, address: document.getElementById('ad-text').value });
            showAddressList();
        }

        document.getElementById('open-cart').onclick = () => {
            modalCont.style.display = 'flex';
            if(cart.length === 0) {
                modalBody.innerHTML = `<h2>ğŸœï¸ Ú©Ù„Ú©Ø³ÛŒÙˆÙ†Øª Ø±Ùˆ Ú¯Ù… Ú©Ø±Ø¯ÛŒØŸ Ø¨ÛŒØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø³Ø§Ø²ÛŒÙ…Ø´!</h2><button class="action-btn" onclick="modalCont.style.display='none'">Ø¨Ø²Ù† Ø¨Ø±ÛŒÙ…</button>`;
            } else {
                let items = cart.map(i => `
                    <div class="cart-horizontal">
                        <img src="${i.img}">
                        <div style="flex:1"><b>${i.name}</b><br><small>${i.price}</small></div>
                    </div>
                `).join('');
                modalBody.innerHTML = `
                    <h2>Ú©Ù„Ú©Ø³ÛŒÙˆÙ† Ù…Ù† âœ¨</h2>
                    <div style="max-height:300px; overflow-y:auto">${items}</div>
                    <button class="action-btn" onclick="proceedToAddress()">Ø§Ø¯Ø§Ù…Ù‡ Ø®Ø±ÛŒØ¯</button>
                `;
            }
        };

        function proceedToAddress() {
            if(!userProfile) { alert('Ø§ÙˆÙ„ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø´ÛŒ!'); showLoginStep(); return; }
            if(addresses.length === 0) { alert('Ù„Ø·ÙØ§ ÛŒÚ© Ø¢Ø¯Ø±Ø³ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†!'); showNewAddressForm(); return; }
            
            let opts = addresses.map((a, i) => `<div onclick="finalStep()" style="cursor:pointer; padding:10px; border:1px solid #eee; border-radius:10px; margin-top:10px;">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡: ${a.title}</div>`).join('');
            modalBody.innerHTML = `<h2>Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø¯Ø±Ø³ ğŸšš</h2>${opts}`;
        }

        function finalStep() {
            modalBody.innerHTML = `
                <div style="text-align:center; padding:20px;">
                    <h2>Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ ğŸ’³</h2>
                    <p style="margin-top:15px">Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¬Ø§Ø¯ÙˆØŸ</p>
                    <button class="action-btn" style="background:green" onclick="showFinish()">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
                </div>
            `;
        }

        function showFinish() {
            modalBody.innerHTML = `
                <div style="text-align:center; padding:20px;">
                    <h1 style="font-size:50px;">ğŸ‰</h1>
                    <h2>Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯</h2>
                    <p style="margin-top:20px; color:#444">Ù¾Ø§ÛŒØ§Ù† Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù¾ÙˆØ±ÛŒØ§ Ùˆ Gemini Pro</p>
                    <button class="action-btn" onclick="location.reload()">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
                </div>
            `;
        }

        window.onclick = (e) => { if(e.target == modalCont) modalCont.style.display = 'none'; };
    </script>
</body>
</html>





